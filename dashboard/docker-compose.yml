services:
  dashboard:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: dashboard
    env_file:
      - ../.env
    environment:
      - NODE_ENV=production
      - DASHBOARD_PORT=4242
      - AUTH_SERVICE_URL=${AUTH_SERVICE_URL:-https://auth.korczewski.de}
      - ADMIN_PASSWORD=${DASHBOARD_ADMIN_PASSWORD}
    expose:
      - "4242"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - dashboard_logs:/var/log/dashboard
      - /home/patrick/projects:/home/patrick/projects:ro
    networks:
      - traefik-public
    labels:
      # Enable Traefik
      - "traefik.enable=true"
      - "traefik.docker.network=traefik-public"

      # HTTP Router for Dashboard
      - "traefik.http.routers.dashboard.rule=Host(`dashboard.korczewski.de`)"
      - "traefik.http.routers.dashboard.entrypoints=websecure"
      - "traefik.http.routers.dashboard.tls=true"

      # Service configuration
      - "traefik.http.services.dashboard.loadbalancer.server.port=4242"

      # Middlewares - Admin authentication + default chain
      - "traefik.http.routers.dashboard.middlewares=admin-auth@file,default-chain@file"
    restart: unless-stopped

volumes:
  dashboard_logs:
    driver: local

networks:
  traefik-public:
    external: true
    name: traefik-public
