services:
  web:
    build: .
    expose:
      - "3000"
    env_file:
      - .env-prod
    networks:
      - traefik-public
    external_links:
      - shared-postgres
    labels:
      # Enable Traefik
      - "traefik.enable=true"
      - "traefik.docker.network=traefik-public"

      # HTTP Router
      - "traefik.http.routers.payment.rule=Host(`payment.korczewski.de`)"
      - "traefik.http.routers.payment.entrypoints=websecure"
      - "traefik.http.routers.payment.tls=true"

      # Service configuration
      - "traefik.http.services.payment.loadbalancer.server.port=3000"

      # Middlewares
      - "traefik.http.routers.payment.middlewares=default-chain@file"

networks:
  traefik-public:
    external: true
    name: traefik-public
